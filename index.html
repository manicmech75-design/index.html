<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA -->
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#0b1220" />
  <link rel="icon" href="/icons/icon-192.png" />

  <!-- Google AdSense -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9059824893360194"
    crossorigin="anonymous"></script>

  <title>City Flip</title>

  <style>
    * { box-sizing: border-box; }
    body{
      margin:0; min-height:100vh;
      background: radial-gradient(circle at top, #1a245f, #05070f);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      color:#fff; display:flex; justify-content:center; align-items:center;
      overflow:hidden;
    }
    #app{ width:min(420px,100%); padding:14px; text-align:center; }
    h1{ margin:6px 0; }
    .sub{ opacity:.7; font-size:13px; margin-bottom:10px; }
    .seg{ display:flex; justify-content:center; gap:6px; margin-bottom:10px; flex-wrap:wrap; }
    .seg button{
      padding:8px 14px; border-radius:999px; border:none;
      background:#111a33; color:#9fb0d6; font-weight:700; cursor:pointer;
    }
    .seg button.active{ background:#6ee7ff; color:#000; }
    .btn{
      padding:12px 18px; border-radius:14px; border:none;
      background: linear-gradient(#6ee7ff, #4fd3e8);
      color:#000; font-weight:900; margin:6px; cursor:pointer;
    }
    .hud{ display:flex; justify-content:center; gap:12px; font-size:12px; opacity:.85; margin-top:8px; }
    .grid{ display:grid; grid-template-columns:repeat(4,70px); gap:12px; justify-content:center; margin-top:14px; }
    .card{
      width:70px; height:70px; border-radius:16px; background:#111a33;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; transition:transform .12s; user-select:none;
    }
    .card:active{ transform:scale(.95); }
    .card.revealed{ background:#182149; }
    .card.matched{ opacity:.85; }
    .card span{ font-size:52px; line-height:1; }
  </style>
</head>

<body>
  <main id="app">
    <h1>City Flip</h1>
    <div class="sub">Flip fast. Match cities.</div>

    <div class="seg" role="tablist" aria-label="Mode">
      <button id="classic" class="active" type="button">Classic</button>
      <button id="time" type="button">Time</button>
      <button id="daily" type="button">Daily</button>
    </div>

    <button id="start" class="btn" type="button">Start</button>

    <div class="hud">
      <div>‚è± <span id="timeVal">‚Äî</span></div>
      <div>‚≠ê <span id="scoreVal">0</span></div>
    </div>

    <div id="grid" class="grid" aria-label="Game board"></div>
  </main>

  <script>
    /* ========================= GAME DATA ========================= */
    // Use real emoji (your README showed mostly blanks)
    const icons = ["üèôÔ∏è","üåâ","üóº","üè∞","üèüÔ∏è","üõ£Ô∏è","üö¶","üóΩ"];

    let deck = [];
    let first = null;
    let lock = false;
    let score = 0;
    let timeLeft = 60;
    let timer = null;
    let mode = "classic";

    /* ========================= MONETIZATION (STUB) ========================= */
    function rewardedAd(callback){
      alert("Ad watched ‚úî");
      callback();
    }

    /* ========================= GAME LOGIC ========================= */
    const grid = document.getElementById("grid");
    const scoreVal = document.getElementById("scoreVal");
    const timeVal = document.getElementById("timeVal");

    function shuffle(){
      deck = [...icons, ...icons].sort(()=>Math.random()-0.5);
    }

    function build(){
      grid.innerHTML = "";
      shuffle();
      deck.forEach(icon=>{
        const c = document.createElement("div");
        c.className = "card";
        c.dataset.icon = icon;
        c.onclick = ()=>flip(c);
        grid.appendChild(c);
      });
    }

    function reveal(card){
      card.innerHTML = "<span>" + card.dataset.icon + "</span>";
      card.classList.add("revealed");
    }

    function hide(card){
      card.innerHTML = "";
      card.classList.remove("revealed");
    }

    function flip(card){
      if(lock || card.classList.contains("matched") || card === first) return;

      reveal(card);

      if(!first){ first = card; return; }

      if(first.dataset.icon === card.dataset.icon){
        first.classList.add("matched");
        card.classList.add("matched");
        score += 100;
        scoreVal.textContent = score;
        first = null;

        if(document.querySelectorAll(".matched").length === 16){
          endGame(true);
        }
      } else {
        lock = true;
        setTimeout(()=>{
          hide(first);
          hide(card);
          first = null;
          lock = false;
        }, 600);
      }
    }

    function startTimer(){
      clearInterval(timer);
      timeVal.textContent = timeLeft;
      timer = setInterval(()=>{
        timeLeft--;
        timeVal.textContent = timeLeft;
        if(timeLeft <= 0){
          endGame(false);
        }
      }, 1000);
    }

    function endGame(win){
      clearInterval(timer);
      setTimeout(()=>{
        if(!win && mode !== "classic"){
          rewardedAd(reset);
        } else {
          alert(win ? "You win!" : "Try again!");
          reset();
        }
      }, 300);
    }

    function setActive(btnId){
      ["classic","time","daily"].forEach(id=>{
        document.getElementById(id).classList.toggle("active", id === btnId);
      });
    }

    function reset(){
      clearInterval(timer);
      score = 0;
      timeLeft = 60;
      scoreVal.textContent = "0";
      timeVal.textContent = (mode === "time") ? String(timeLeft) : "‚Äî";
      first = null;
      lock = false;
      build();
    }

    document.getElementById("start").onclick = ()=>{
      reset();
      if(mode === "time") startTimer();
    };
    document.getElementById("classic").onclick = ()=>{
      mode="classic"; setActive("classic"); reset();
    };
    document.getElementById("time").onclick = ()=>{
      mode="time"; setActive("time"); reset();
    };
    document.getElementById("daily").onclick = ()=>{
      mode="daily"; setActive("daily"); reset();
    };

    build();

    /* ========================= SERVICE WORKER ========================= */
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("/sw.js").catch(()=>{});
      });
    }
  </script>
</body>
</html>
